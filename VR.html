<!DOCTYPE html>
<html>
  <head>
    <script src="https://aframe.io/releases/1.3.0/aframe.min.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/donmccurdy/aframe-extras@v6.1.1/dist/aframe-extras.min.js"></script>
  </head>
  <body>
    <a-scene>
      <!-- Player with hand controllers -->
      <a-entity position="0 1.6 0" movement-controls="fly: true">
        <a-camera></a-camera>
        
        <!-- Left Hand -->
        <a-entity id="left-hand"
                  hand-controls="hand: left"
                  oculus-touch-controls="hand: left"
                  vive-controls="hand: left"
                  windows-motion-controls="hand: left">
          <a-sphere radius="0.03" color="blue" position="0 0.05 0"></a-sphere>
          <a-box width="0.04" height="0.08" depth="0.04" color="lightblue" position="0 -0.02 0"></a-box>
        </a-entity>

        <!-- Right Hand -->
        <a-entity id="right-hand"
                  hand-controls="hand: right"
                  oculus-touch-controls="hand: right"
                  vive-controls="hand: right"
                  windows-motion-controls="hand: right">
          <a-sphere radius="0.03" color="red" position="0 0.05 0"></a-sphere>
          <a-box width="0.04" height="0.08" depth="0.04" color="pink" position="0 -0.02 0"></a-box>
        </a-entity>
      </a-entity>

      <!-- Grabbable Objects -->
      <a-box id="box1" 
             position="-1 1 -3" 
             rotation="0 45 0" 
             color="#4CC3D9" 
             grabbable 
             class="interactable">
        <a-animation attribute="position" 
                     to="1 1 -3" 
                     direction="alternate" 
                     dur="2000" 
                     repeat="indefinite"></a-animation>
      </a-box>
      
      <a-sphere id="sphere1" 
                position="0 1.5 -4" 
                radius="0.5" 
                color="#EF2D5E" 
                grabbable 
                class="interactable"></a-sphere>
      
      <a-cylinder id="cylinder1" 
                  position="1 1 -3" 
                  radius="0.3" 
                  height="1" 
                  color="#FFC65D" 
                  grabbable 
                  class="interactable"></a-cylinder>

      <!-- Game Floor -->
      <a-plane position="0 0 -4" rotation="-90 0 0" width="8" height="8" color="#7BC8A4" static-body></a-plane>
      <a-sky color="#ECECEC"></a-sky>
    </a-scene>

    <script>
      // Add physics and interaction systems
      AFRAME.registerComponent('grabbable', {
        init: function() {
          this.el.setAttribute('dynamic-body', 'shape: box');
          this.startPosition = new THREE.Vector3();
          this.offset = new THREE.Vector3();
          this.grabbed = false;
          
          this.handleGrab = this.handleGrab.bind(this);
          this.handleRelease = this.handleRelease.bind(this);
          
          this.el.addEventListener('grab-start', this.handleGrab);
          this.el.addEventListener('grab-end', this.handleRelease);
        },
        
        handleGrab: function(evt) {
          this.grabbed = true;
          this.startPosition.copy(this.el.object3D.position);
          const controller = evt.detail.hand.object3D;
          this.offset.subVectors(this.startPosition, controller.position);
        },
        
        handleRelease: function() {
          this.grabbed = false;
        },
        
        tick: function() {
          if (this.grabbed) {
            const controller = this.el.sceneEl.systems['tracked-controls'].controllers[0] || 
                              this.el.sceneEl.systems['tracked-controls'].controllers[1];
            if (controller && controller.pose.position) {
              const pos = controller.pose.position;
              this.el.object3D.position.set(pos.x + this.offset.x, 
                                           pos.y + this.offset.y, 
                                           pos.z + this.offset.z);
            }
          }
        }
      });
    </script>
  </body>
</html>
