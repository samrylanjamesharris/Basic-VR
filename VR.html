<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Simple VR Game</title>
    <script src="https://aframe.io/releases/1.3.0/aframe.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/aframe-environment-component@1.3.1/dist/aframe-environment-component.min.js"></script>
    <style>
        html, body {
            margin: 0;
            padding: 0;
            width: 100%;
            height: 100%;
            overflow: hidden;
            font-family: Arial, sans-serif;
        }
        #ui-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 9999;
        }
        .vr-button, .ar-button {
            position: absolute;
            bottom: 20px;
            padding: 10px 20px;
            background-color: rgba(30, 30, 30, 0.7);
            color: white;
            border: none;
            border-radius: 5px;
            font-size: 16px;
            cursor: pointer;
            pointer-events: auto;
            z-index: 10000;
        }
        .vr-button {
            left: 20px;
        }
        .ar-button {
            left: 120px;
        }
        .joystick-container {
            position: absolute;
            bottom: 20px;
            right: 20px;
            width: 120px;
            height: 120px;
            background-color: rgba(30, 30, 30, 0.5);
            border-radius: 50%;
            pointer-events: auto;
            z-index: 10000;
        }
        .joystick {
            position: absolute;
            width: 60px;
            height: 60px;
            background-color: rgba(255, 255, 255, 0.8);
            border-radius: 50%;
            top: 30px;
            left: 30px;
            transition: transform 0.1s;
        }
        #hud {
            position: absolute;
            top: 20px;
            left: 0;
            width: 100%;
            text-align: center;
            color: white;
            font-size: 24px;
            pointer-events: none;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.5);
        }
    </style>
</head>
<body>
    <a-scene 
        vr-mode-ui="enabled: true"
        background="color: #87CEEB"
        xr-mode-ui="XRMode: vr"
        shadow="type: pcfsoft">
        
        <!-- Lighting Setup -->
        <a-entity id="sun" light="type: directional; color: #FFF; intensity: 0.8; castShadow: true;" 
                  position="5 10 5" rotation="-45 0 0"></a-entity>
        <a-entity light="type: ambient; color: #88C; intensity: 0.3"></a-entity>
        <a-entity light="type: point; color: #FFE; intensity: 0.5; distance: 10" position="0 3 0"></a-entity>
        
        <!-- Sun Visual -->
        <a-sphere id="sun-visual" radius="0.5" color="#FFD700" position="5 10 5" 
                  animation="property: rotation; to: 0 360 0; loop: true; dur: 20000"></a-sphere>
        
        <!-- Environment -->
        <a-entity environment="preset: forest; lighting: none; shadow: false"></a-entity>
        
        <!-- Player with camera and hands -->
        <a-entity id="player" movement-controls="speed: 0.1">
            <a-entity camera look-controls position="0 1.6 0"></a-entity>
            
            <!-- Left hand -->
            <a-entity id="left-hand" 
                      hand-controls="hand: left"
                      vive-controls="hand: left"
                      oculus-touch-controls="hand: left"
                      windows-motion-controls="hand: left"
                      position="-0.2 0 -0.5">
                <a-box color="#0077ff" scale="0.1 0.2 0.1" shadow="cast: true"></a-box>
            </a-entity>
            
            <!-- Right hand -->
            <a-entity id="right-hand" 
                      hand-controls="hand: right"
                      vive-controls="hand: right"
                      oculus-touch-controls="hand: right"
                      windows-motion-controls="hand: right"
                      position="0.2 0 -0.5">
                <a-box color="#ff4400" scale="0.1 0.2 0.1" shadow="cast: true"></a-box>
            </a-entity>
        </a-entity>
        
        <!-- Interactive objects -->
        <a-sphere id="target" 
                  color="red" 
                  radius="0.5" 
                  position="0 1.5 -3"
                  class="clickable"
                  shadow="cast: true; receive: true">
        </a-sphere>
        
        <a-box id="cube" 
               color="blue" 
               width="1" 
               height="1" 
               depth="1" 
               position="3 1.5 -3"
               class="clickable"
               shadow="cast: true; receive: true">
        </a-box>
        
        <a-cylinder id="cylinder" 
                    color="green" 
                    radius="0.5" 
                    height="1" 
                    position="-3 1.5 -3"
                    class="clickable"
                    shadow="cast: true; receive: true">
        </a-cylinder>
        
        <!-- Additional decorative objects -->
        <a-box id="platform1" 
               color="#8B4513" 
               width="2" 
               height="0.5" 
               depth="2" 
               position="0 0.25 -5"
               shadow="receive: true">
        </a-box>
        
        <a-cone id="tree1" 
                color="#228B22" 
                radius-bottom="0.8" 
                radius-top="0" 
                height="3" 
                position="4 1.5 -4"
                shadow="cast: true; receive: true">
        </a-cone>
        
        <a-cone id="tree2" 
                color="#228B22" 
                radius-bottom="0.6" 
                radius-top="0" 
                height="2.5" 
                position="-4 1.25 -6"
                shadow="cast: true; receive: true">
        </a-cone>
        
        <!-- 3D Menu -->
        <a-entity id="menu" position="0 2 -2" visible="false">
            <a-text value="VR GAME MENU" 
                    align="center" 
                    color="white" 
                    position="0 1.5 0" 
                    scale="2 2 2">
            </a-text>
            <a-box id="start-btn" 
                   color="#4CAF50" 
                   width="1.5" 
                   height="0.5" 
                   depth="0.1" 
                   position="0 0.5 0"
                   class="menu-item"
                   shadow="cast: true; receive: true">
                <a-text value="START" 
                        align="center" 
                        position="0 0 0.06" 
                        scale="2 2 2">
                </a-text>
            </a-box>
            <a-box id="exit-btn" 
                   color="#f44336" 
                   width="1.5" 
                   height="0.5" 
                   depth="0.1" 
                   position="0 -0.5 0"
                   class="menu-item"
                   shadow="cast: true; receive: true">
                <a-text value="EXIT" 
                        align="center" 
                        position="0 0 0.06" 
                        scale="2 2 2">
                </a-text>
            </a-box>
        </a-entity>
        
        <!-- Ground -->
        <a-plane color="#7BC8A4" 
                 rotation="-90 0 0" 
                 width="20" 
                 height="20"
                 shadow="receive: true">
        </a-plane>
        
        <!-- Sky -->
        <a-sky color="#87CEEB"></a-sky>
    </a-scene>
    
    <!-- UI Overlay -->
    <div id="ui-overlay">
        <button class="vr-button" id="enter-vr">Enter VR</button>
        <button class="ar-button" id="enter-ar">Enter AR</button>
        
        <div class="joystick-container" id="joystick-container">
            <div class="joystick" id="joystick"></div>
        </div>
        
        <div id="hud">Score: 0</div>
    </div>

    <script>
        // Initialize score
        let score = 0;
        const hud = document.getElementById('hud');
        
        // VR/AR mode buttons
        const vrButton = document.getElementById('enter-vr');
        const arButton = document.getElementById('enter-ar');
        
        vrButton.addEventListener('click', function() {
            const scene = document.querySelector('a-scene');
            if (scene.hasAttribute('vr-mode-ui')) {
                scene.enterVR();
            }
        });
        
        arButton.addEventListener('click', function() {
            const scene = document.querySelector('a-scene');
            if (scene.hasAttribute('ar-mode')) {
                scene.enterAR();
            }
        });
        
        // Joystick movement
        const joystickContainer = document.getElementById('joystick-container');
        const joystick = document.getElementById('joystick');
        const player = document.getElementById('player');
        
        let isDragging = false;
        let joystickCenterX, joystickCenterY;
        let joystickRadius;
        
        // Initialize joystick
        function initJoystick() {
            const rect = joystickContainer.getBoundingClientRect();
            joystickCenterX = rect.left + rect.width / 2;
            joystickCenterY = rect.top + rect.height / 2;
            joystickRadius = rect.width / 2;
        }
        
        window.addEventListener('resize', initJoystick);
        initJoystick();
        
        // Touch/Mouse events for joystick
        joystickContainer.addEventListener('mousedown', startDrag);
        joystickContainer.addEventListener('touchstart', startDrag);
        
        document.addEventListener('mousemove', drag);
        document.addEventListener('touchmove', drag);
        
        document.addEventListener('mouseup', endDrag);
        document.addEventListener('touchend', endDrag);
        
        function startDrag(e) {
            e.preventDefault();
            isDragging = true;
        }
        
        function drag(e) {
            if (!isDragging) return;
            
            let clientX, clientY;
            
            if (e.type === 'mousemove') {
                clientX = e.clientX;
                clientY = e.clientY;
            } else if (e.type === 'touchmove') {
                clientX = e.touches[0].clientX;
                clientY = e.touches[0].clientY;
            }
            
            // Calculate distance from center
            const deltaX = clientX - joystickCenterX;
            const deltaY = clientY - joystickCenterY;
            const distance = Math.sqrt(deltaX * deltaX + deltaY * deltaY);
            
            // Limit joystick to container bounds
            let limitedX = deltaX;
            let limitedY = deltaY;
            
            if (distance > joystickRadius) {
                limitedX = (deltaX / distance) * joystickRadius;
                limitedY = (deltaY / distance) * joystickRadius;
            }
            
            // Update joystick position
            joystick.style.transform = `translate(${limitedX}px, ${limitedY}px)`;
            
            // Normalize values for movement
            const normalizedX = limitedX / joystickRadius;
            const normalizedY = limitedY / joystickRadius;
            
            // Move player based on joystick input
            if (player && player.components['movement-controls']) {
                // Set joystick state for movement-controls component
                player.setAttribute('movement-controls', {
                    controls: `joystick: ${normalizedX}, ${normalizedY}`
                });
            }
        }
        
        function endDrag() {
            isDragging = false;
            // Reset joystick position
            joystick.style.transform = 'translate(0, 0)';
            
            // Stop player movement
            if (player && player.components['movement-controls']) {
                player.setAttribute('movement-controls', {
                    controls: 'joystick: 0, 0'
                });
            }
        }
        
        // Handle object interactions
        const interactiveObjects = document.querySelectorAll('.clickable');
        interactiveObjects.forEach(obj => {
            obj.addEventListener('click', function() {
                // Change color when clicked
                const colors = ['red', 'blue', 'green', 'yellow', 'purple', 'orange'];
                const randomColor = colors[Math.floor(Math.random() * colors.length)];
                obj.setAttribute('color', randomColor);
                
                // Add a glowing effect
                obj.setAttribute('animation', `property: material.emissive; to: ${randomColor}; dur: 300; easing: easeOutQuad; loop: false`);
                
                // Increase score
                score++;
                hud.textContent = `Score: ${score}`;
                
                // Move object to a new random position
                const x = Math.random() * 8 - 4;
                const z = Math.random() * 6 - 8;
                obj.setAttribute('position', {x: x, y: 1.5, z: z});
                
                // Reset emissive after animation
                setTimeout(() => {
                    obj.setAttribute('animation', `property: material.emissive; to: black; dur: 300; easing: easeOutQuad; loop: false`);
                }, 300);
            });
        });
        
        // Handle 3D menu interactions
        const menu = document.getElementById('menu');
        const startBtn = document.getElementById('start-btn');
        const exitBtn = document.getElementById('exit-btn');
        
        startBtn.addEventListener('click', function() {
            menu.setAttribute('visible', 'false');
            // Reset score
            score = 0;
            hud.textContent = `Score: ${score}`;
        });
        
        exitBtn.addEventListener('click', function() {
            // In a real game, you might want to exit the experience
            alert('Exit button clicked!');
        });
        
        // Show menu when pressing 'M' key (for testing without VR controllers)
        document.addEventListener('keydown', function(e) {
            if (e.key === 'm' || e.key === 'M') {
                const isVisible = menu.getAttribute('visible');
                menu.setAttribute('visible', isVisible === 'false' ? 'true' : 'false');
            }
        });
        
        // VR controller events for menu
        const leftHand = document.getElementById('left-hand');
        const rightHand = document.getElementById('right-hand');
        
        // Listen for controller events to toggle menu
        [leftHand, rightHand].forEach(hand => {
            hand.addEventListener('triggerdown', function() {
                // Check if hand is pointing at menu
                // In a real implementation, you'd use raycaster to detect menu items
                const isVisible = menu.getAttribute('visible');
                menu.setAttribute('visible', isVisible === 'false' ? 'true' : 'false');
            });
        });
        
        // Day/Night cycle (optional)
        let isDay = true;
        const sun = document.getElementById('sun');
        const sunVisual = document.getElementById('sun-visual');
        const sky = document.querySelector('a-sky');
        
        // Toggle day/night when pressing 'N' key
        document.addEventListener('keydown', function(e) {
            if (e.key === 'n' || e.key === 'N') {
                isDay = !isDay;
                
                if (isDay) {
                    // Switch to day
                    sun.setAttribute('light', 'intensity', 0.8);
                    sun.setAttribute('position', '5 10 5');
                    sunVisual.setAttribute('position', '5 10 5');
                    sky.setAttribute('color', '#87CEEB');
                } else {
                    // Switch to night
                    sun.setAttribute('light', 'intensity', 0.1);
                    sun.setAttribute('position', '0 1 5');
                    sunVisual.setAttribute('position', '0 1 5');
                    sky.setAttribute('color', '#000033');
                }
            }
        });
    </script>
</body>
</html>
